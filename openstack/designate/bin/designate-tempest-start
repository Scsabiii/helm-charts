#!/usr/bin/env bash

set -e
set -x

function start_tempest_tests {
    echo "\n === CONFIGURING TEMPEST === \n"
    rally-manage db ensure
    rally deployment create --file /designate-etc/tempest_deployment_config.json --name tempest_deployment
    rally deployment check
    rally --debug verify create-verifier --type tempest --name designate-tempest-verifier --system-wide --source https://github.com/sapcc/tempest
    rally --debug verify configure-verifier --extend /designate-etc/tempest_extra_options
    sleep 30
    echo "\n === STARTING TEMPEST TESTS FOR DESIGNATE === \n"
    rally --debug verify start --concurrency 1 --detailed --pattern designate_tempest_plugin.
}

start_tempest_tests
